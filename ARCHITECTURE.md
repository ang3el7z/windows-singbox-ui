# Архитектура проекта SingBox-UI

## Структура проекта

```
SingBox-UI/
├── main.py                 # Главный файл приложения
├── config/                 # Конфигурация
│   ├── __init__.py
│   └── paths.py           # Пути к файлам и директориям
├── managers/              # Менеджеры данных
│   ├── __init__.py
│   ├── settings.py        # Менеджер настроек
│   └── subscriptions.py   # Менеджер подписок
├── utils/                 # Утилиты
│   ├── __init__.py
│   ├── i18n.py           # Система локализации
│   └── singbox.py        # Утилиты для работы с SingBox
├── core/                  # Основная логика
│   ├── __init__.py
│   └── downloader.py     # Загрузка SingBox
├── ui/                    # Интерфейс (зарезервировано для будущего)
│   └── __init__.py
├── locales/              # Файлы локализации
│   ├── ru.json           # Русский язык
│   └── en.json           # Английский язык
├── data/                 # Данные приложения (создается автоматически)
│   ├── core/             # Ядро SingBox
│   ├── logs/             # Логи
│   └── config.json       # Конфиг
├── SingBox-UI.spec       # Конфигурация PyInstaller
├── post_build.py         # Скрипт пост-обработки сборки
└── requirements.txt      # Зависимости
```

## Модули

### config/
- **paths.py** - Определение всех путей к файлам и директориям
- Функция `ensure_dirs()` - создание необходимых папок

### managers/
- **settings.py** - Управление настройками приложения
  - Сохранение/загрузка настроек
  - Поддержка языка интерфейса
  
- **subscriptions.py** - Управление подписками
  - CRUD операции с подписками
  - Скачивание конфигов

### utils/
- **i18n.py** - Система локализации
  - Класс `Translator` для работы с переводами
  - Функция `tr()` для получения переводов
  - Поддержка форматирования строк
  
- **singbox.py** - Утилиты для SingBox
  - Получение версии SingBox

### core/
- **downloader.py** - Загрузка SingBox
  - Класс `DownloadThread` для загрузки в отдельном потоке
  - Автоматическая установка последней версии

### locales/
- **ru.json** - Русские переводы
- **en.json** - Английские переводы

## Использование локализации

```python
from utils.i18n import tr, set_language

# Получить перевод
text = tr("home.version")  # "Версия SingBox"

# С параметрами
text = tr("home.installed", version="1.8.0")  # "Установлено: версия 1.8.0"

# Изменить язык
set_language("en")  # Переключить на английский
```

## Добавление нового языка

1. Создайте файл `locales/xx.json` (где xx - код языка)
2. Скопируйте структуру из `ru.json`
3. Переведите все строки
4. Язык будет доступен автоматически

## Преимущества архитектуры

1. **Модульность** - код разделен на логические модули
2. **Локализация** - легко добавлять новые языки
3. **Расширяемость** - легко добавлять новые функции
4. **Поддерживаемость** - проще находить и исправлять ошибки
5. **Тестируемость** - модули можно тестировать отдельно

## Сборка проекта

### Требования
- Python 3.8+
- PyInstaller 6.0+

### Команда сборки
```bash
py -m PyInstaller SingBox-UI.spec --clean --noconfirm
py post_build.py
```

### Результат сборки
После сборки в папке `dist/SingBox-UI/` будет:
- `SingBox-UI.exe` - главный исполняемый файл
- `locales/` - файлы локализации
- `data/core/` - ядро SingBox (если было включено)
- `_internal/` - библиотеки и зависимости

## Разработка

### Запуск в режиме разработки
```bash
python main.py
```

### Структура данных
Все данные приложения хранятся в папке `data/`:
- `data/core/sing-box.exe` - ядро SingBox
- `data/logs/singbox.log` - логи приложения
- `data/config.json` - конфигурация SingBox
- `data/.subscriptions` - список подписок (JSON)
- `data/.settings` - настройки приложения (JSON)
